name: kbw
title: Ket Bitwise Simulator Server
summary: Quantum computer simulator for the Ket Quantum Programming
description: |
  The Ket Bitwise Simulator Server executes Ket Quantum Assembly (KQASM) files
  generated by the Libket, using the bitwise representation. It is also
  necessary by the Ket quantum programming language to simulate quantum
  execution.

  Usage:

      $ kbw -h        
      Ket Bitwise Simulator server
      ============================

      usage: kbw [-h] [-b ::1] [-p 4242] [-l]

      Ket Bitwise Simulator server

      optional arguments:
        -h, --help  show this help message and exit
        -b ::1      Server bind
        -p 4242     Server port
        -l          Extra plugin path

  This project is part of the Ket Quantum Programming framework that also
  features:

  * The Ket quantum programming language;
  * The C++ quantum programming library Libket.

  See the documentation for more information http://quantum-ket.gitlab.io.

icon: logo/kbw11.svg

license: Apache-2.0

version: git
grade: devel

base: core20
confinement: strict

architectures:
  - build-on: amd64
    run-on: amd64

parts: 
  snapcraft-preload:
    source: https://github.com/sergiusens/snapcraft-preload.git
    plugin: cmake
    cmake-parameters:
      - -DCMAKE_INSTALL_PREFIX=/
    build-packages:
      - on amd64:
        - gcc-multilib
        - g++-multilib
    stage-packages:
      - on amd64:
        - lib32stdc++6

  flask:
    plugin: python
    python-packages: 
      - flask>=2
      - gevent>=21.1.2
    stage-packages:
      - libpython3.8-dev
      - libpython3.8-minimal
      - libpython3.8-stdlib
      - python3.8-minimal
  
  kbw:
    plugin: python
    source: .
    build-packages: 
      - cmake
      - curl
      - default-jre
      - g++
      - gcc
      - libssl-dev
      - make
      - pkg-config
      - swig
      - unzip
      - uuid-dev
    filesets:
      kbw-files:
        - lib/python3.8/site-packages/kbw*
    stage:
      - $kbw-files
    after: 
      - snapcraft-preload
      - flask
 
apps:
  kbw:
    command: bin/snapcraft-preload $SNAP/usr/bin/python3.8 -m kbw
    plugs:
      - home
      - network
      - network-bind
    environment:
      LC_ALL: C.UTF-8
      LANG: C.UTF-8
      PYTHONPATH: $SNAP/lib/python3.8:$SNAP/usr/lib/python3.8/lib-dynload:$SNAP/lib/python3.8/site-packages:$SNAP_USER_COMMON/lib/python3.8/site-packages
